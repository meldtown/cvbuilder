<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>

	<link rel="stylesheet" href="http://css.rabota.com.ua/theme/rua/css/masterpage.css"/>
	<link rel="stylesheet" href="http://css.rabota.com.ua/theme/rua/css/blocks/select2.css"/>

	<script src="node_modules/jquery/dist/jquery.js"></script>
	<script src="http://js.rabota.com.ua/src/js/tooltips.js"></script>
	<script src="http://js.rabota.com.ua/js/jquery-ui-1.10.3/ui/jquery-ui-1.10.3.custom.min.js"></script>
	<script src="http://js.rabota.com.ua/js/jquery.ui.tooltips.js"></script>
	<script src="http://css.rabota.com.ua/js/jquery.lazyload.min.js"></script>
	<script src="http://js.rabota.com.ua/src/js/controls/templates/header.js"></script>
	<script src="node_modules/knockout/build/output/knockout-latest.debug.js"></script>
	<!--<script src="http://js.rabota.com.ua/js/knockout-3.3.0.js"></script>-->
	<script src="http://js.rabota.com.ua/js/bootstrap-2.3.2/js/bootstrap-carousel.js"></script>
	<script src="http://js.rabota.com.ua/js/select2-4.0.0/dist/js/select2.full.js"></script>
	<script src="http://js.rabota.com.ua/js/select2-4.0.0/dist/js/i18n/ru.js"></script>

	<style>
		html, body.rua-l-body {
			background-color: #F7F7F7;
		}
	</style>

	<script src="node_modules/moment/moment.js"></script>
	<script src="node_modules/moment/locale/ru.js"></script>
	<script src="node_modules/moment/locale/uk.js"></script>
	<script src="node_modules/knockout.validation/dist/knockout.validation.js"></script>
	<script src="node_modules/ko.editables/ko.editables.js"></script>

	<link rel="stylesheet" href="dist/cvbuilder.css">

	<script src="js/DictionaryModel.js"></script>

	<style>
		.validationElement, select.input-block-level.validationElement:focus {
			border: 1px solid red
		}

		.validationMessage {
			color: red
		}
	</style>
</head>
<body class="rua-l-body">
<div class="header header-default">
	<ul class="header-inner">
		<li class="header-item header-item-logo">
			<a class="header-link" href="/"><i class="ri_logo" style="padding-right: 0;"></i></a>
		</li>
	</ul>
</div>

<div class="rua-l-wrapper2">
	<select data-bind="options: _lngOptions, value: _lng"></select>

	<div>
		<span>dateBirth:</span>
		<span data-bind="text: dateBirth"></span>
	</div>
	<div>
		<span>dateBirth:</span>
		<input data-bind="value: dateBirth, valueUpdate: 'keyup', validationElement: dateBirth">
	</div>

	<datepicker-widget params="value: dateBirth, _lng: _lng, validationElement: dateBirth"></datepicker-widget>
</div>

<script id="datepicker-widget" type="text/html">
	<div class="row">
		<div class="col d-1of4">
			<select data-bind="optionsCaption: 'date', options: dateOptions, value: selectedDateOption, validationElement: validationElement" class="input-block-level"></select>
		</div>
		<div class="col d-2of4 d-pl-1of2 d-pr-1of2">
			<select data-bind="optionsCaption: 'month', options: monthOptions, value: selectedMonthOption, optionsText: 'label', validationElement: validationElement" class="input-block-level"></select>
		</div>
		<div class="col d-1of4">
			<select data-bind="optionsCaption: 'year', options: yearOptions, value: selectedYearOption, validationElement: validationElement" class="input-block-level"></select>
		</div>
	</div>
	<span class="validationMessage" data-bind="validationMessage: value"></span>
</script>

<script>
	ko.components.register('datepicker-widget', {
		viewModel: function (params) {
			var model = this;

			model._lng = params._lng;
			model.value = params.value;
			model.validationElement = params.validationElement;

			model.updateValue = function () {
				var date = model.selectedDateOption();
				var month = model.selectedMonthOption() ? model.selectedMonthOption().id : null;
				var year = model.selectedYearOption();

				if (date && month && year) {
					model.value(moment(new Date(year, month, date)).format());
				} else {
					model.value(undefined);
				}
			};

			model.dateOptions = [];
			for (var date = 1; date < 32; date++) {
				model.dateOptions.push(date);
			}
			model.selectedDateOption = ko.observable();
			model.selectedDateOption.subscribe(function (newValue) {
				model.updateValue();
			});

			model.monthOptions = [
				{"id": 0, "ru": "январь", "ua": "січень", "en": "january"},
				{"id": 1, "ru": "февраль", "ua": "лютий", "en": "february"},
				{"id": 2, "ru": "март", "ua": "березень", "en": "march"},
				{"id": 3, "ru": "апрель", "ua": "квітень", "en": "april"},
				{"id": 4, "ru": "май", "ua": "травень", "en": "may"},
				{"id": 5, "ru": "июнь", "ua": "червень", "en": "june"},
				{"id": 6, "ru": "июль", "ua": "липень", "en": "july"},
				{"id": 7, "ru": "август", "ua": "серпень", "en": "august"},
				{"id": 8, "ru": "сентябрь", "ua": "вересень", "en": "september"},
				{"id": 9, "ru": "октябрь", "ua": "жовтень", "en": "october"},
				{"id": 10, "ru": "ноябрь", "ua": "листопад", "en": "november"},
				{"id": 11, "ru": "декабрь", "ua": "грудень", "en": "december"}
			].map(function (item) {
				return new DictionaryModel(model, item);
			});
			model.selectedMonthOption = ko.observable();
			model.selectedMonthOption.subscribe(function (newValue) {
				model.updateValue();
			});

			model.yearOptions = [];
			for (var year = (new Date()).getFullYear(); year >= (new Date()).getFullYear() - 80; year--) {
				model.yearOptions.push(year);
			}
			model.selectedYearOption = ko.observable();
			model.selectedYearOption.subscribe(function (newValue) {
				model.updateValue();
			});

			if (model.value()) {
				model.selectedDateOption(moment(model.value()).date());
				model.selectedMonthOption(model.monthOptions[moment(model.value()).month()]);
				model.selectedYearOption(moment(model.value()).year());
			}
		},
		template: document.getElementById('datepicker-widget').innerHTML
	});

	function Model () {
		var model = this;

		model._lng = ko.observable('ru');
		model._lngOptions = ['ru', 'ua', 'en'];

		model.resources = {
			errorMessageDateBirthRequired: new DictionaryModel(model, {
				en: 'Date of birth required',
				ru: 'Дата рождения обязательна',
				ua: 'Дата народження обовязкова'
			})
		};

		var sample = '1966-05-08T00:00:00';
		model.dateBirth = ko.observable(sample).extend({
			required: {
				params: true,
				message: function (params, observable) {
					return model.resources.errorMessageDateBirthRequired.label();
				}
			}
		});
	}

	var model = new Model();
	ko.applyBindings(model);
</script>

<!--suppress JSUnresolvedLibraryURL -->
<script
	id="__bs_script__">document.write('<script async src="http://HOST:3000/browser-sync/browser-sync-client.2.12.8.js"><\/script>'.replace('HOST', location.hostname))</script>
</body>
</html>
